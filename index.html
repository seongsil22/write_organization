<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>AI ê¸€ ì •ë¦¬ í”„ë¡œê·¸ë¨ by Gemini</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
            line-height: 1.6;
            margin: 0 auto;
            max-width: 800px;
            padding: 20px;
            background-color: #f9f9f9;
            color: #333;
        }
        h1, h2 {
            border-bottom: 2px solid #eee;
            padding-bottom: 10px;
            color: #1a73e8;
        }
        textarea {
            width: 100%;
            height: 250px;
            padding: 10px;
            border-radius: 8px;
            border: 1px solid #ddd;
            font-size: 16px;
            resize: vertical;
        }
        .output-box {
            background-color: white;
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 20px;
            margin-top: 20px;
            white-space: pre-wrap;
            word-wrap: break-word;
        }
        .loader {
            text-align: center;
            font-style: italic;
            color: #888;
        }
        .error-message {
            color: red;
            font-weight: bold;
        }
        .header-with-button {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        #copyButton {
            padding: 6px 12px;
            font-size: 14px;
            background-color: #e0e0e0;
            color: #333;
            border-radius: 8px;
            border: none;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        #copyButton:hover {
            background-color: #ccc;
        }
    </style>
</head>
<body>

    <h1 class="text-3xl font-bold text-center mb-2">AI ê¸€ ì •ë¦¬ í”„ë¡œê·¸ë¨ âœ¨</h1>
    <p class="text-center text-gray-600 mb-8">ì•„ë˜ ìƒìì— ì •ë¦¬í•  ê¸€ì„ ë¶™ì—¬ë„£ê³  'ì •ë¦¬í•˜ê¸°' ë²„íŠ¼ì„ ëˆ„ë¥´ì„¸ìš”.</p>

    <!-- API í‚¤ ì…ë ¥ ì„¹ì…˜ -->
    <div class="mb-6">
        <label for="apiKeyInput" class="block text-sm font-medium text-gray-700 mb-1">Gemini API í‚¤</label>
        <input type="password" id="apiKeyInput" class="w-full p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500" placeholder="API í‚¤ë¥¼ ì…ë ¥í•˜ì„¸ìš”">
        <p class="text-xs text-gray-500 mt-1">API í‚¤ëŠ” ë¸Œë¼ìš°ì €ì—ë§Œ ì €ì¥ë˜ë©° ì™¸ë¶€ë¡œ ì „ì†¡ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤. <a href="https://aistudio.google.com/" target="_blank" class="text-blue-600 hover:underline">API í‚¤ ë°œê¸‰ ë°©ë²•</a></p>
    </div>

    <textarea id="inputText" placeholder="ì—¬ê¸°ì— ì •ë¦¬í•˜ê³  ì‹¶ì€ ê¸€ ì „ë¬¸ì„ ë¶™ì—¬ë„£ìœ¼ì„¸ìš”..." class="mb-4"></textarea>
    
    <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4">
        <!-- Action Buttons -->
        <div class="flex items-center gap-2">
            <button id="processButton" onclick="processText()" class="flex items-center justify-center px-5 py-3 text-sm font-medium text-white bg-blue-600 rounded-lg hover:bg-blue-700 focus:outline-none focus:ring-4 focus:ring-blue-300 disabled:bg-gray-400 disabled:cursor-not-allowed transition-colors">
                <svg class="w-5 h-5 mr-2 -ml-1" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"></path></svg>
                ì •ë¦¬í•˜ê¸°
            </button>
            <button id="clearButton" onclick="clearAll()" class="flex items-center justify-center px-5 py-3 text-sm font-medium text-gray-800 bg-gray-200 rounded-lg hover:bg-gray-300 focus:outline-none focus:ring-4 focus:ring-gray-300 transition-colors">
                 <svg class="w-5 h-5 mr-2 -ml-1" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path></svg>
                ì „ì²´ ì‚­ì œ
            </button>
        </div>
        <!-- Analysis Option -->
        <div class="flex items-center pt-2 sm:pt-0">
            <input type="checkbox" id="includeAnalysis" class="h-4 w-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500">
            <label for="includeAnalysis" class="ml-2 text-sm text-gray-700">ë‚´ìš© ê²€ì¦ ë° ë¶„ì„ í¬í•¨ (ì‹œê°„ì´ ë” ê±¸ë¦´ ìˆ˜ ìˆìŠµë‹ˆë‹¤)</label>
        </div>
    </div>

    <div class="header-with-button mt-8">
        <h2>âœ”ï¸ ì •ë¦¬ëœ ê¸€ (ë§ì¶¤ë²• ìˆ˜ì •)</h2>
        <button id="copyButton" onclick="copyCleanedText()">ë³µì‚¬í•˜ê¸°</button>
    </div>
    <div id="cleanedOutput" class="output-box">ì •ë¦¬ëœ ê¸€ì´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤.</div>

    <div id="analysisContainer" style="display: none;">
        <h2>ğŸ”¬ ë‚´ìš© ê²€ì¦ ë° ë¶„ì„</h2>
        <div id="analysisOutput" class="output-box">ë‚´ìš© ë¶„ì„ ê²°ê³¼ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤.</div>
    </div>

    <script>
        const apiKeyInput = document.getElementById('apiKeyInput');

        // í˜ì´ì§€ ë¡œë“œ ì‹œ localStorageì—ì„œ API í‚¤ ë¶ˆëŸ¬ì˜¤ê¸°
        apiKeyInput.value = localStorage.getItem('geminiApiKey_textProcessor') || '';

        // API í‚¤ê°€ ë³€ê²½ë  ë•Œ localStorageì— ì €ì¥í•˜ê¸°
        apiKeyInput.addEventListener('input', () => {
            localStorage.setItem('geminiApiKey_textProcessor', apiKeyInput.value);
        });
        
        function clearAll() {
            document.getElementById('inputText').value = '';
            document.getElementById('cleanedOutput').innerHTML = 'ì •ë¦¬ëœ ê¸€ì´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤.';
            
            const analysisContainer = document.getElementById('analysisContainer');
            analysisContainer.style.display = 'none';
            document.getElementById('analysisOutput').innerHTML = 'ë‚´ìš© ë¶„ì„ ê²°ê³¼ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤.';
            document.getElementById('copyButton').textContent = 'ë³µì‚¬í•˜ê¸°';
        }

        function copyCleanedText() {
            const textToCopy = document.getElementById('cleanedOutput').innerText;
            const copyButton = document.getElementById('copyButton');
            
            if (!textToCopy || textToCopy.includes('ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤')) {
                alert('ë³µì‚¬í•  ë‚´ìš©ì´ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }

            const tempTextArea = document.createElement('textarea');
            tempTextArea.value = textToCopy;
            document.body.appendChild(tempTextArea);
            tempTextArea.select();
            document.execCommand('copy');
            document.body.removeChild(tempTextArea);

            copyButton.textContent = 'ë³µì‚¬ ì™„ë£Œ!';
            setTimeout(() => {
                copyButton.textContent = 'ë³µì‚¬í•˜ê¸°';
            }, 2000);
        }

        async function processText() {
            const API_KEY = apiKeyInput.value.trim();

            if (!API_KEY) {
                alert("Gemini API í‚¤ë¥¼ ì…ë ¥ í•„ë“œì— ì…ë ¥í•´ì£¼ì„¸ìš”.");
                return;
            }

            const userText = document.getElementById('inputText').value;
            if (!userText.trim()) {
                alert("ì •ë¦¬í•  ê¸€ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.");
                return;
            }

            const processButton = document.getElementById('processButton');
            const cleanedDiv = document.getElementById('cleanedOutput');
            const analysisContainer = document.getElementById('analysisContainer');
            const analysisDiv = document.getElementById('analysisOutput');
            const includeAnalysisCheckbox = document.getElementById('includeAnalysis');

            processButton.disabled = true;
            processButton.textContent = "ì²˜ë¦¬ ì¤‘...";
            cleanedDiv.innerHTML = '<div class="loader">AIê°€ ê¸€ì„ ì •ë¦¬í•˜ê³  ìˆìŠµë‹ˆë‹¤...</div>';
            
            if(includeAnalysisCheckbox.checked) {
                analysisContainer.style.display = 'block';
                analysisDiv.innerHTML = '<div class="loader">AIê°€ ë‚´ìš©ì„ ë¶„ì„í•˜ê³  ìˆìŠµë‹ˆë‹¤...</div>';
            } else {
                analysisContainer.style.display = 'none';
            }

            const API_URL = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${API_KEY}`;
            
            let systemPrompt = `
                ë‹¹ì‹ ì€ ê¸€ì„ ì •ë¦¬í•˜ê³  ë¶„ì„í•˜ëŠ” AI ì–´ì‹œìŠ¤í„´íŠ¸ì…ë‹ˆë‹¤. ë‹¤ìŒ ìš”ì²­ì‚¬í•­ì„ ì •í™•íˆ ìˆ˜í–‰í•´ì£¼ì„¸ìš”.

                ìš”ì²­ì‚¬í•­:
                1. ì£¼ì–´ì§„ ì›ë³¸ ê¸€ì„ ë‚´ìš©ì˜ ì£¼ì œë³„ë¡œ ë¬¸ë‹¨ì„ ë‚˜ëˆ„ì–´ ê°€ë…ì„± ì¢‹ê²Œ ì¬êµ¬ì„±í•´ì£¼ì„¸ìš”. (ê°™ì€ ì£¼ì œëŠ” ë¶™ì´ê³ , ë‹¤ë¥¸ ì£¼ì œëŠ” í•œ ì¤„ ë„ê¸°)
                2. ëª…ë°±í•œ ë§ì¶¤ë²• ì˜¤ë¥˜ë‚˜ ì˜¤íƒ€ëŠ” ìˆ˜ì •í•´ì£¼ì„¸ìš”.
                3. í•˜ì§€ë§Œ ì‚¬ìš©ìê°€ ì˜ë„ì ìœ¼ë¡œ ì“´ ê²ƒìœ¼ë¡œ ë³´ì´ëŠ” ë¹„ì†ì–´(ì˜ˆ: 'ìë¹ ì¡ŒëŠ”ë°', 'ê°œì‘ì‚´', 'ê¹ì¹˜ë‹¤' ë“±)ëŠ” ìˆ˜ì •í•˜ì§€ ë§ê³  ê·¸ëŒ€ë¡œ ìœ ì§€í•´ì£¼ì„¸ìš”.
            `;

            let jsonStructure = `
                5. ìµœì¢… ê²°ê³¼ë¬¼ì€ ë°˜ë“œì‹œ ì•„ë˜ì™€ ê°™ì€ JSON í˜•ì‹ìœ¼ë¡œ ë°˜í™˜í•´ì£¼ì„¸ìš”.

                {
                  "cleanedText": "ì—¬ê¸°ì— 1, 2, 3ë²ˆ ìš”ì²­ì— ë”°ë¼ ì •ë¦¬ëœ ê¸€ ì „ë¬¸ì„ ë„£ìœ¼ì„¸ìš”."
                }
            `;

            if (includeAnalysisCheckbox.checked) {
                systemPrompt += `
                4. ìˆ˜ì •ëœ ê¸€ê³¼ëŠ” ë³„ê°œë¡œ, ì›ë³¸ ê¸€ì˜ ë‚´ìš©ì— ëŒ€í•œ 'ì¢…í•© ê²€ì¦ ë° ë¶„ì„'ì„ ì œê³µí•´ì£¼ì„¸ìš”. ë¶„ì„ì—ëŠ” ì „ë°˜ì ì¸ ìš”ì•½, ì£¼ìš” ì£¼ì¥, í‘œí˜„ ë°©ì‹, ê²€ì¦ í¬ì¸íŠ¸(ì‚¬ì‹¤ê³¼ ì£¼ì¥ì˜ êµ¬ë¶„), ìµœì¢… ê²°ë¡ ì´ í¬í•¨ë˜ì–´ì•¼ í•©ë‹ˆë‹¤.
                `;
                jsonStructure = `
                5. ìµœì¢… ê²°ê³¼ë¬¼ì€ ë°˜ë“œì‹œ ì•„ë˜ì™€ ê°™ì€ JSON í˜•ì‹ìœ¼ë¡œ ë°˜í™˜í•´ì£¼ì„¸ìš”.

                {
                  "cleanedText": "ì—¬ê¸°ì— 1, 2, 3ë²ˆ ìš”ì²­ì— ë”°ë¼ ì •ë¦¬ëœ ê¸€ ì „ë¬¸ì„ ë„£ìœ¼ì„¸ìš”.",
                  "analysis": "ì—¬ê¸°ì— 4ë²ˆ ìš”ì²­ì— ë”°ë¼ ë§ˆí¬ë‹¤ìš´ í˜•ì‹ìœ¼ë¡œ ì‘ì„±ëœ ë¶„ì„ ë‚´ìš©ì„ ë„£ìœ¼ì„¸ìš”."
                }
                `;
            }

            const finalPrompt = systemPrompt + jsonStructure;
            const userQuery = `[ì›ë³¸ ê¸€]\n---\n${userText}\n---`;

            const payload = {
                contents: [{ parts: [{ text: userQuery }] }],
                systemInstruction: {
                    parts: [{ text: finalPrompt }]
                },
                generationConfig: {
                    responseMimeType: "application/json",
                }
            };

            try {
                const response = await fetch(API_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                if (!response.ok) {
                    const errorBody = await response.json();
                    throw new Error(`API ìš”ì²­ ì‹¤íŒ¨: ${response.status} ${response.statusText} - ${errorBody.error?.message || 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜'}`);
                }

                const data = await response.json();
                const candidate = data.candidates?.[0];
                const rawJsonText = candidate?.content?.parts?.[0]?.text;

                if (rawJsonText) {
                    const parsedData = JSON.parse(rawJsonText);
                    
                    if (parsedData.cleanedText) {
                        cleanedDiv.textContent = parsedData.cleanedText;
                    } else {
                        throw new Error('API ì‘ë‹µ JSONì— cleanedText í‚¤ê°€ ì—†ìŠµë‹ˆë‹¤.');
                    }

                    if (includeAnalysisCheckbox.checked) {
                        if (parsedData.analysis) {
                            let analysisHtml = parsedData.analysis;
                            analysisHtml = analysisHtml.replace(/## (.*)/g, '<h3>$1</h3>');
                            analysisHtml = analysisHtml.replace(/\*\*([^*]+)\*\*/g, '<strong>$1</strong>');
                            analysisHtml = analysisHtml.replace(/-\s(.*)/g, '<li>$1</li>')
                                                 .replace(/(<\/li>)(?!<ul>)/g, '</li></ul>')
                                                 .replace(/(<li>)/g, '<ul>$1');
                            analysisDiv.innerHTML = analysisHtml;
                        } else {
                             analysisDiv.innerHTML = '<p>ë¶„ì„ ê²°ê³¼ë¥¼ ê°€ì ¸ì˜¤ëŠ” ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.</p>';
                        }
                    }
                
                } else {
                    throw new Error('API ì‘ë‹µì—ì„œ ìœ íš¨í•œ í…ìŠ¤íŠ¸ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                }
            } catch (error) {
                cleanedDiv.innerHTML = `<p class="error-message">ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.</p>`;
                if (includeAnalysisCheckbox.checked) {
                    analysisDiv.innerHTML = `<p class="error-message">ì˜¤ë¥˜ ìƒì„¸ ì •ë³´:</p><p>${error.message}</p>`;
                }
                console.error('Error:', error);
            } finally {
                processButton.disabled = false;
                processButton.textContent = "ì •ë¦¬í•˜ê¸°";
            }
        }
    </script>

</body>
</html>

